import requests
import json
import re

# Função para extrair IDs dos filmes a partir de uma playlist M3U
def extract_movie_ids(playlist_url):
    response = requests.get(playlist_url)
    content = response.text
    # Regex para encontrar todos os tvg-id
    movie_ids = re.findall(r'tvg-id="(\d+)"', content)
    return movie_ids

# URL da playlist M3U (deve ser acessível via HTTP/HTTPS)
playlist_url = 'https://docs.google.com/uc?export=download&id=1ot8ylvaZMdGDtntCIn4A3WhQiNzP09gn'

# Extrair os IDs dos filmes da playlist
movie_ids = extract_movie_ids(playlist_url)

# Substitua 'YOUR_API_KEY' pela sua chave da API do TMDb
api_key = '6e2e6889fccce1a5b1d120f2d8f56b8c'
base_url = 'https://api.themoviedb.org/3/movie/'

# Inicializa uma lista para armazenar os dados dos filmes
movies_data = []

for movie_id in movie_ids:
    url = f'{base_url}{movie_id}?api_key={api_key}'
    response = requests.get(url)
    data = response.json()

    # Captura dos metadados necessários
    movie_data = {
        "id": movie_id,
        "title": data.get("title"),
        "overview": data.get("overview"),
        "poster_path": f'https://image.tmdb.org/t/p/w500{data.get("poster_path")}',
        "homepage": data.get("homepage")  # Substitua pelo URL real do vídeo
    }
    movies_data.append(movie_data)

# Salva os metadados em um arquivo JSON
with open('movies_metadata.json', 'w') as file:
    json.dump(movies_data, file, indent=4)
